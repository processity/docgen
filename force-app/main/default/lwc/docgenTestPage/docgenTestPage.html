<template>
    <lightning-card title="Docgen E2E Test Page" icon-name="custom:custom78">
        <!-- Object Type Selection Section -->
        <div class="slds-m-around_medium">
            <lightning-card title="Select Object Type" icon-name="standard:generic_loading">
                <div class="slds-p-around_medium">
                    <lightning-combobox
                        label="Object Type"
                        value={selectedObjectApiName}
                        placeholder="Select an object type"
                        options={objectTypeOptions}
                        onchange={handleObjectTypeChange}
                        required>
                    </lightning-combobox>
                </div>
            </lightning-card>
        </div>

        <!-- Record Lookup Section (shown when object type is selected) -->
        <template if:true={selectedObjectApiName}>
            <div class="slds-m-around_medium">
                <lightning-card title={recordSelectionTitle} icon-name={selectedObjectIcon}>
                    <div class="slds-p-around_medium">
                        <template if:true={recordId}>
                            <lightning-record-picker
                                label={selectedObjectLabel}
                                placeholder={recordSearchPlaceholder}
                                object-api-name={selectedObjectApiName}
                                value={recordId}
                                onchange={handleRecordSelection}>
                            </lightning-record-picker>
                        </template>
                        <template if:false={recordId}>
                            <lightning-record-picker
                                label={selectedObjectLabel}
                                placeholder={recordSearchPlaceholder}
                                object-api-name={selectedObjectApiName}
                                onchange={handleRecordSelection}>
                            </lightning-record-picker>
                        </template>
                    </div>
                </lightning-card>
            </div>
        </template>

        <!-- Main content when recordId is available -->
        <template if:true={recordId}>
            <!-- Record Details Section -->
            <div class="slds-m-around_medium">
                <lightning-card title={recordDetailsTitle} icon-name={selectedObjectIcon}>
                    <div class="slds-p-horizontal_medium">
                        <lightning-record-view-form record-id={recordId} object-api-name={selectedObjectApiName}>
                            <div class="slds-grid slds-wrap">
                                <div class="slds-col slds-size_1-of-1 slds-p-around_small">
                                    <lightning-output-field field-name="Name"></lightning-output-field>
                                </div>
                            </div>
                        </lightning-record-view-form>
                    </div>
                </lightning-card>
            </div>

            <!-- Docgen Button Section -->
            <div class="slds-m-around_medium">
                <lightning-card title="Document Generation" icon-name="action:new_note">
                    <div class="slds-p-around_medium">
                        <!-- Template Selection -->
                        <div class="slds-m-bottom_medium">
                            <lightning-record-picker
                                label="Template"
                                placeholder="Search Templates..."
                                object-api-name="Docgen_Template__c"
                                value={templateId}
                                onchange={handleTemplateSelection}>
                            </lightning-record-picker>
                        </div>

                        <!-- Generate Button (enabled when template is selected) -->
                        <template if:true={templateId}>
                            <c-docgen-button
                                record-id={recordId}
                                template-id={templateId}
                                output-format="PDF"
                                button-label="Generate Test Document"
                                success-message="Test document generated successfully!">
                            </c-docgen-button>
                        </template>
                        <template if:false={templateId}>
                            <div class="slds-text-color_weak slds-text-align_center">
                                Please select a template to generate a document.
                            </div>
                        </template>
                    </div>
                </lightning-card>
            </div>

            <!-- Generated Documents Section -->
            <div class="slds-m-around_medium">
                <lightning-card title="Generated Documents" icon-name="standard:file">
                    <div class="slds-p-around_medium">
                        <template if:true={generatedDocuments}>
                            <lightning-datatable
                                key-field="Id"
                                data={generatedDocuments}
                                columns={columns}
                                hide-checkbox-column>
                            </lightning-datatable>
                        </template>
                        <template if:false={generatedDocuments}>
                            <div class="slds-text-align_center slds-p-around_medium slds-text-color_weak">
                                No generated documents found for this record.
                            </div>
                        </template>
                    </div>
                </lightning-card>
            </div>
        </template>
    </lightning-card>
</template>
